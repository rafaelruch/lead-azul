networks:
  whaticket:

services:

  backend:
    build:
      context: ./backend
      dockerfile: ./Dockerfile
    environment:
      - DB_HOST=mysql
      - DB_USER=root
      - DB_PASS=b48eb506d00f8219ae738316cdde8114a08b953b
      - DB_NAME=db-lead-azul
      - JWT_SECRET=${JWT_SECRET:-3123123213123}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET:-75756756756}
      - BACKEND_URL=https://testapi.ruch.com.br
      - FRONTEND_URL=https://test.ruch.com.br
      - PROXY_PORT=443
      - CHROME_ARGS=--no-sandbox --disable-setuid-sandbox
    volumes:
      - ./backend/public/:/usr/src/app/public/
      - ./backend/.wwebjs_auth/:/usr/src/app/.wwebjs_auth/
    networks:
      - whaticket

  frontend:
    build:
      context: ./frontend
      dockerfile: ./Dockerfile
    environment:
      - URL_BACKEND=backend:3000
      - REACT_APP_BACKEND_URL=https://testapi.ruch.com.br/
      - FRONTEND_SERVER_NAME=test.ruch.com.br
      - BACKEND_SERVER_NAME=testapi.ruch.com.br
    volumes:
      - ./ssl/certs/:/etc/nginx/ssl/
      - ./ssl/www/:/var/www/letsencrypt/
    networks:
      - whaticket

  mysql:
    image: mariadb:10.6
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_bin
    volumes:
      - ./.docker/data/:/var/lib/mysql
    environment:
      - MYSQL_DATABASE=db-lead-azul
      - MYSQL_ROOT_PASSWORD=b48eb506d00f8219ae738316cdde8114a08b953b
      - TZ=America/Fortaleza
    restart: always
    networks:
      - whaticket
